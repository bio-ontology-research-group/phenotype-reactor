VIRTUOSO_CONTAINER="pheno_virtuoso"

rule virtuoso:
    output: touch("virtuoso.done")
    shell:"./start-virtuoso.sh {VIRTUOSO_CONTAINER}"

rule t_doid_dp:
    output: touch("t_doid_dp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s doid_dp"

rule t_hpo_dp:
    output: touch("t_hpo_dp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s hpo_dp"

rule t_mondo_dp:
    output: touch("t_mondo_dp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s mondo_dp"

rule t_patho_dp:
    output: touch("t_patho_dp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s patho_dp"

rule t_pubchem_dp:
    output: touch("t_pubchem_dp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s pubchem_dp"

rule t_txtmind_gp:
    output: touch("t_txtmind_gp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s txtmind_gp"

rule t_deep_gp:
    output: touch("t_deep_gp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s deep_gp"

rule t_patho_pp:
    output: touch("t_patho_pp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s patho_pp"

rule t_mp:
    output: touch("t_mp.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py transform -s mp"

rule archive:
    input: "t_doid_dp.done", 
            "t_hpo_dp.done", 
            "t_patho_dp.done", 
            "t_pubchem_dp.done", 
            "t_txtmind_gp.done", 
            "t_deep_gp.done", 
            "t_patho_pp.done", 
            "t_mp.done", 
    output: touch("archive.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py archiverdf"

rule deploy_rdf:
    input: "archive.done",  
            "virtuoso.done",
    output: touch("deploy.done")
    shell:"./deployds.sh {VIRTUOSO_CONTAINER}"

rule load_rdf:
    input: "deploy.done",  
            "virtuoso.done",
    output: touch("load.done")
    shell:
        "cd ../../;"
        "venv/bin/python manage.py loadvirtuoso"
    